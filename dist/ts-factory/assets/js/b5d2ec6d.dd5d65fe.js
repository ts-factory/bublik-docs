"use strict";(self.webpackChunkbublik_release=self.webpackChunkbublik_release||[]).push([[3488],{3546:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var r=i(9729);const l={},s=r.createContext(l);function t(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),r.createElement(s.Provider,{value:n},e.children)}},4302:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"docker/network","title":"Network-Restricted Deployment","description":"- First Deploy","source":"@site/docs/08-docker/05-network.md","sourceDirName":"08-docker","slug":"/docker/network","permalink":"/bublik/docs/docker/network","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Network-Restricted Deployment"},"sidebar":"defaultSidebar","previous":{"title":"Build And Publish Images","permalink":"/bublik/docs/docker/build"}}');var l=i(5813),s=i(3546);const t={title:"Network-Restricted Deployment"},o=void 0,a={},c=[{value:"First Deploy",id:"first-deploy",level:2},{value:"Preparation Machine",id:"preparation-machine",level:3},{value:"Create Bublik User",id:"create-bublik-user",level:4},{value:"Install Dependencies",id:"install-dependencies",level:4},{value:"Prepare Initial Deploy",id:"prepare-initial-deploy",level:4},{value:"Test",id:"test",level:4},{value:"Setup Preparation Machine",id:"setup-preparation-machine",level:4},{value:"Configuration",id:"configuration",level:4},{value:"What You Have Prepared",id:"what-you-have-prepared",level:4},{value:"Transfer To Deployment machine",id:"transfer-to-deployment-machine",level:4},{value:"Deploy Machine",id:"deploy-machine",level:3},{value:"Create Bublik User",id:"create-bublik-user-1",level:4},{value:"Extract Deployment Package",id:"extract-deployment-package",level:4},{value:"Install docker",id:"install-docker",level:4},{value:"Configuration",id:"configuration-1",level:4},{value:"Finish Initial Deploy",id:"finish-initial-deploy",level:4},{value:"Update",id:"update",level:2},{value:"Pre-Update Checklist",id:"pre-update-checklist",level:4},{value:"Preparation Machine",id:"preparation-machine-1",level:3},{value:"Step 1: Prepare New Version",id:"step-1-prepare-new-version",level:4},{value:"Step 2: Create Update Package",id:"step-2-create-update-package",level:4},{value:"Deployment Machine",id:"deployment-machine",level:3},{value:"Step 3: Backup Current System (On Deployment Machine)",id:"step-3-backup-current-system-on-deployment-machine",level:4},{value:"Step 4: Apply Update (On Deployment Machine)",id:"step-4-apply-update-on-deployment-machine",level:4},{value:"Step 5: Start Updated Application (On Deployment Machine)",id:"step-5-start-updated-application-on-deployment-machine",level:4},{value:"Update Path Example",id:"update-path-example",level:3},{value:"Post-Deployment",id:"post-deployment",level:2},{value:"Access Your Application",id:"access-your-application",level:3},{value:"Database Migration (If Applicable)",id:"database-migration-if-applicable",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"#first-deploy",children:"First Deploy"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"#preparation-machine",children:"Preparation Machine"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#install-dependencies",children:"Install Dependencies"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#prepare-initial-deploy",children:"Prepare Initial Deploy"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#test",children:"Test"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#setup-preparation-machine",children:"Setup Preparation Machine"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#configuration",children:"Configuration"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#what-you-have-prepared",children:"What You Have Prepared"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#transfer-to-deployment-machine",children:"Transfer To Deployment machine"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"#deploy-machine",children:"Deploy Machine"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#install-docker",children:"Install docker"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#configuration",children:"Configuration"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#finish-initial-deploy",children:"Finish Initial Deploy"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"#update",children:"Update"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#pre-update-checklist",children:"Pre-Update Checklist"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"#preparation-machine",children:"Preparation Machine"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#step-1-prepare-new-version",children:"Step 1: Prepare New Version"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#step-2-create-update-package",children:"Step 2: Create Update Package"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"#deployment-machine",children:"Deployment Machine"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#step-3-backup-current-system-on-deployment-machine",children:"Step 3: Backup Current System (On Deployment Machine)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#step-4-apply-update-on-deployment-machine",children:"Step 4: Apply Update (On Deployment Machine)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#step-5-start-updated-application-on-deployment-machine",children:"Step 5: Start Updated Application (On Deployment Machine)"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#update-path-example",children:"Update Path Example"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"#post-deployment",children:"Post-Deployment"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#access-your-application",children:"Access Your Application"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#database-migration-if-applicable",children:"Database Migration (If Applicable)"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"This guide walks you through deploying Bublik in an network-restricted environment using two machines:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Preparation Machine"}),": Has internet access, used for downloading and preparing components"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Deploy Machine"}),": Air-gapped Ubuntu 24.04 LTS system where Bublik will be deployed"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Both machines should be ",(0,l.jsx)(n.strong,{children:"Ubuntu 24.04 LTS"}),"\nWe support ",(0,l.jsx)(n.code,{children:"arm64"})," and ",(0,l.jsx)(n.code,{children:"amd64"}),"\nWe assume ",(0,l.jsx)(n.code,{children:"amd64"})," in below instructions"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"first-deploy",children:"First Deploy"}),"\n",(0,l.jsx)(n.h3,{id:"preparation-machine",children:"Preparation Machine"}),"\n",(0,l.jsx)(n.h4,{id:"create-bublik-user",children:"Create Bublik User"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Create bublik user with home directory\nsudo useradd -m -s /bin/bash bublik\n\n# Create and set ownership of bublik directory\nsudo mkdir -p /opt/bublik-docker\nsudo chown -R bublik:bublik /opt/bublik-docker\n\n# Add bublik user to docker group (will be needed after docker installation)\nsudo usermod -aG docker bublik\n"})}),"\n",(0,l.jsx)(n.h4,{id:"install-dependencies",children:"Install Dependencies"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo apt-get update && sudo apt-get install jq git curl\n\n# A restart may or may not be required for the command to be recognized depending on your system.\nsudo snap install --classic go\n\n# Add GOBIN to path so task works\necho 'export PATH=\"$HOME/go/bin:$PATH\"' >> ~/.bashrc\n\n# Install task from source\ngo install github.com/go-task/task/v3/cmd/task@latest\n\n# Install Docker and Docker Compose\nsudo curl -fsSL https://get.docker.com | sh\n\nsudo usermod -aG docker $USER\n# Apply group changes (allows running docker without sudo)\nnewgrp docker\n\nsource $HOME/.bashrc\n\n# Switch to bublik user for all remaining operations\nsudo su - bublik\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Verify installation:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"curl --version\njq --version\ngo version\ntask --version\ngit --version\ndocker --version\ndocker compose version\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["All subsequent commands in this guide should be run as the ",(0,l.jsx)(n.code,{children:"bublik"})," user."]})}),"\n",(0,l.jsx)(n.h4,{id:"prepare-initial-deploy",children:"Prepare Initial Deploy"}),"\n",(0,l.jsx)(n.p,{children:"You will now create deploy package to transfer to deployment machine"}),"\n",(0,l.jsx)(n.h4,{id:"test",children:"Test"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# 1. Setup directories\nmkdir -p /opt/bublik-docker/deps\nmkdir -p /opt/bublik-docker/bin\nmkdir -p /opt/bublik-docker/images\nmkdir -p /opt/bublik-docker/versions\nmkdir -p /opt/bublik-docker/config\n\n# 2. Prepare required binaries\ncp $(which task) /opt/bublik-docker/bin\n# Skip if deployment machine have jq already installed\ncp $(which jq) /opt/bublik-docker/bin\n# Skip if deployment machine have curl already installed\ncp $(which curl) /opt/bublik-docker/bin\n# Skip if deployment machine has git already installed\ncp $(which git) /opt/bublik-docker/bin\n\n# 3. Download Docker packages\ncd /opt/bublik-docker/deps && apt download docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin && cd -\n"})}),"\n",(0,l.jsx)(n.h4,{id:"setup-preparation-machine",children:"Setup Preparation Machine"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Set bublik version (REQUIRED - Set this before proceeding)\nexport BUBLIK_VERSION=2.1.0\n\necho "Using Bublik version: $BUBLIK_VERSION"\n\n# 1. Clone repository\ngit clone --branch "v$BUBLIK_VERSION" --recurse-submodules https://github.com/ts-factory/bublik-docker.git "/opt/bublik-docker/versions/bublik-$BUBLIK_VERSION"\n\n# 2. Setup link to current deploy repo\nln -s "/opt/bublik-docker/versions/bublik-$BUBLIK_VERSION" "/opt/bublik-docker/current"\nls -lha /opt/bublik-docker | grep "current"\n\n# 3. Setup .env file\ncp /opt/bublik-docker/current/.env.example /opt/bublik-docker/config/.env\nln -s /opt/bublik-docker/config/.env /opt/bublik-docker/current/.env\nls -lha /opt/bublik-docker/current/.env | grep ".env"\n\n# 4. Setup IDs (needed for correct permissions)\necho "HOST_UID=$(id -u)" >> /opt/bublik-docker/config/.env\necho "HOST_GID=$(id -g)" >> /opt/bublik-docker/config/.env\n\n# 5. Set correct version so it pulls correct image versions\nsed -i "s/^IMAGE_TAG=.*/IMAGE_TAG=$BUBLIK_VERSION/" /opt/bublik-docker/config/.env\n# Verify correct image tag is set\ncat /opt/bublik-docker/current/.env | grep "IMAGE_TAG"\n\n# 6. Pull images\ncd /opt/bublik-docker/current && task pull\n\n# 7. Check that images pulled\ndocker image ls\n\n# 8. Save images\ndocker save -o "/opt/bublik-docker/images/bublik-$BUBLIK_VERSION.tar" \\\n  "ghcr.io/ts-factory/bublik-nginx:$BUBLIK_VERSION" \\\n  "ghcr.io/ts-factory/bublik-log-server:$BUBLIK_VERSION" \\\n  "ghcr.io/ts-factory/bublik-runner:$BUBLIK_VERSION" \\\n  redis:8 \\\n  postgres:17 \\\n  rabbitmq:4-management\n'})}),"\n",(0,l.jsx)(n.h4,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Edit the ",(0,l.jsx)(n.code,{children:".env"})," file: ",(0,l.jsx)(n.code,{children:"/opt/bublik-docker/config/.env"})]}),"\n",(0,l.jsxs)(n.li,{children:["Follow the configuration guide: ",(0,l.jsx)(n.a,{href:"https://ts-factory.github.io/bublik-release/docker/setup#4-configure-environment",children:"Bublik Configuration Documentation"})]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"what-you-have-prepared",children:"What You Have Prepared"}),"\n",(0,l.jsxs)(n.p,{children:["At this point, you have successfully created a complete deployment package in ",(0,l.jsx)(n.code,{children:"/opt/bublik-docker/"})," containing:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"/opt/bublik-docker/\n\u251c\u2500\u2500 deps/                      # Docker installation packages (.deb files)\n\u251c\u2500\u2500 bin/                       # Required executables (task, jq, curl, git)\n\u251c\u2500\u2500 images/                    # Docker images saved as .tar files\n\u2502   \u2514\u2500\u2500 bublik-${BUBLIK_VERSION}.tar\n\u251c\u2500\u2500 config/\n\u2502   \u2514\u2500\u2500 .env                   # Your configured environment file\n\u251c\u2500\u2500 versions/\n\u2502   \u2514\u2500\u2500 bublik-${BUBLIK_VERSION}/      # Complete Bublik repository with all components\n\u2514\u2500\u2500 current -> versions/bublik-${BUBLIK_VERSION}/  # Symlink to active version\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Key components ready for transfer:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 All Docker dependencies and installation packages"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Required executables (task, jq, curl, git)"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Pre-pulled Docker images (saved as .tar archive)"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Complete Bublik application code and configuration"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 Configured environment file with your settings"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"transfer-to-deployment-machine",children:"Transfer To Deployment machine"}),"\n",(0,l.jsx)(n.p,{children:"Now we'll package everything and transfer it to your air-gapped deployment machine."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# 1. Create Archive\ntar czf /tmp/bublik-deploy.tar.gz -C /opt bublik-docker\n\n# 2. Transfer everything to deploy machine\nscp /tmp/bublik-deploy.tar.gz <deploy_machine>:~\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"deploy-machine",children:"Deploy Machine"}),"\n",(0,l.jsx)(n.h4,{id:"create-bublik-user-1",children:"Create Bublik User"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Create bublik user with home directory\nsudo useradd -m -s /bin/bash bublik\n\n# Create and set ownership of bublik directory\nsudo mkdir -p /opt/bublik-docker\nsudo chown -R bublik:bublik /opt/bublik-docker\n\n# Switch to bublik user for all remaining operations\nsudo su - bublik\n"})}),"\n",(0,l.jsx)(n.h4,{id:"extract-deployment-package",children:"Extract Deployment Package"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# 1. Extract initial deploy version\ntar xzf ~/bublik-deploy.tar.gz -C /opt\n\n# 2. Add packaged binaries to PATH\necho 'export PATH=\"/opt/bublik-docker/bin:$PATH\"' >> ~/.bashrc\n\n# 3. Remove archive\nrm ~/bublik-deploy.tar.gz\n\n# 4. Apply change to bashrc\nsource ~/.bashrc\n"})}),"\n",(0,l.jsx)(n.h4,{id:"install-docker",children:"Install docker"}),"\n",(0,l.jsx)(n.admonition,{type:"danger",children:(0,l.jsxs)(n.p,{children:["It's highly recommended to use ",(0,l.jsx)(n.a,{href:"https://docs.docker.com/engine/install/ubuntu/",children:"official way to install"})," ",(0,l.jsx)("br",{}),"\nYou can skip this step if you follow official guide"]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo dpkg -i /opt/bublik-docker/deps/*.deb\nsudo usermod -aG docker bublik\nnewgrp docker\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Verify installation:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"curl --version\njq --version\ntask --version\ngit --version\ndocker --version\ndocker compose version\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["All subsequent commands in this guide should be run as the ",(0,l.jsx)(n.code,{children:"bublik"})," user."]})}),"\n",(0,l.jsx)(n.h4,{id:"configuration-1",children:"Configuration"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Edit the ",(0,l.jsx)(n.code,{children:".env"})," file: ",(0,l.jsx)(n.code,{children:"/opt/bublik-docker/config/.env"})]}),"\n",(0,l.jsxs)(n.li,{children:["Follow the configuration guide: ",(0,l.jsx)(n.a,{href:"https://ts-factory.github.io/bublik-release/docker/setup#4-configure-environment",children:"Bublik Configuration Documentation"})]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"finish-initial-deploy",children:"Finish Initial Deploy"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Set the same version as used on preparation machine (REQUIRED)\nexport BUBLIK_VERSION=2.1.0\n\necho "Using Bublik version: $BUBLIK_VERSION"\n\n# 1. Load images\ndocker load -i "/opt/bublik-docker/images/bublik-$BUBLIK_VERSION.tar"\n\n# 2. Verify correct images loaded\ndocker image ls\n\n# 3. Go to currently linked repo version\ncd /opt/bublik-docker/current\n\n# 4. Link configuration\nln -sfn /opt/bublik-docker/config/.env /opt/bublik-docker/current/.env\n# Verify link\nls -lha /opt/bublik-docker/current/.env | grep ".env"\n\n# 5. Adjust UID and GUID in case it\'s different from prep machine in case they different\nsed -i "s/^HOST_UID=.*/HOST_UID=$(id -u)/" /opt/bublik-docker/config/.env\nsed -i "s/^HOST_GID=.*/HOST_GID=$(id -g)/" /opt/bublik-docker/config/.env\n\n# 6. Verify correct image tag is set\ncat /opt/bublik-docker/current/.env | grep "IMAGE_TAG"\n\n# 7. To start application\ntask up\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"update",children:"Update"}),"\n",(0,l.jsx)(n.admonition,{type:"warning",children:(0,l.jsxs)(n.p,{children:["Sequential updates are mandatory ",(0,l.jsx)("br",{}),"\n",(0,l.jsx)(n.strong,{children:"Never skip minor versions"})," during updates to prevent system instability and data corruption"]})}),"\n",(0,l.jsx)(n.h4,{id:"pre-update-checklist",children:"Pre-Update Checklist"}),"\n",(0,l.jsx)(n.p,{children:"Before beginning any update process:"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.strong,{children:"Create a full database backup"})]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.strong,{children:"Test the update path on a preparation machine first"})]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.strong,{children:"Review release notes for ALL intermediate versions"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"preparation-machine-1",children:"Preparation Machine"}),"\n",(0,l.jsx)(n.p,{children:"Actions in this section should be done on preparation machine"}),"\n",(0,l.jsx)(n.h4,{id:"step-1-prepare-new-version",children:"Step 1: Prepare New Version"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Set the NEW version you want to update to (REQUIRED)\nexport BUBLIK_NEW_VERSION=2.2.0\n\necho "Updating to Bublik version: $BUBLIK_NEW_VERSION"\n\n# 1. Clone new version repository\ngit clone --branch "v$BUBLIK_NEW_VERSION" --recurse-submodules https://github.com/ts-factory/bublik-docker.git "/opt/bublik-docker/versions/bublik-$BUBLIK_NEW_VERSION"\n\n# 2. Update preparation machine to new version\nln -sfn "/opt/bublik-docker/versions/bublik-$BUBLIK_NEW_VERSION" "/opt/bublik-docker/current"\nls -lha /opt/bublik-docker | grep "current"\n\n# 3. Re-link .env configuration\nln -sfn /opt/bublik-docker/config/.env /opt/bublik-docker/current/.env\nls -lha /opt/bublik-docker/current/.env | grep ".env"\n\n# 4. Set correct `IMAGE_TAG` to new version\nsed -i "s/^IMAGE_TAG=.*/IMAGE_TAG=$BUBLIK_NEW_VERSION/" /opt/bublik-docker/config/.env\ncat /opt/bublik-docker/current/.env | grep "IMAGE_TAG"\n\n# 5. Pull new images\ncd /opt/bublik-docker/current && task pull\n\n# 6. Check that images pulled\ndocker image ls\n\n# 7. Save new version images\ndocker save -o "/opt/bublik-docker/images/bublik-$BUBLIK_NEW_VERSION.tar" \\\n  "ghcr.io/ts-factory/bublik-nginx:$BUBLIK_NEW_VERSION" \\\n  "ghcr.io/ts-factory/bublik-log-server:$BUBLIK_NEW_VERSION" \\\n  "ghcr.io/ts-factory/bublik-runner:$BUBLIK_NEW_VERSION" \\\n  redis:8 \\\n  postgres:17 \\\n  rabbitmq:4-management\n'})}),"\n",(0,l.jsx)(n.h4,{id:"step-2-create-update-package",children:"Step 2: Create Update Package"}),"\n",(0,l.jsxs)(n.p,{children:["At this point, you have successfully created a complete update package in ",(0,l.jsx)(n.code,{children:"/opt/bublik-docker"})," containing:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"/opt/bublik-docker/\n\u251c\u2500\u2500 images/                                # Docker images saved as .tar files\n\u2502   \u2514\u2500\u2500 bublik-${BUBLIK_NEW_VERSION}.tar\n\u2514\u2500\u2500 versions/\n    \u2514\u2500\u2500 bublik-${BUBLIK_NEW_VERSION}/      # Complete Bublik repository with all components\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# 1. Create update archive with new version repository and images\ntar czf "/tmp/bublik-update-$BUBLIK_NEW_VERSION.tar.gz" -C /opt/bublik-docker "versions/bublik-$BUBLIK_NEW_VERSION" "images/bublik-$BUBLIK_NEW_VERSION.tar"\n\n# 2. Transfer to deploy machine\nscp "/tmp/bublik-update-$BUBLIK_NEW_VERSION.tar.gz" <deploy_machine>:~\n'})}),"\n",(0,l.jsx)(n.h3,{id:"deployment-machine",children:"Deployment Machine"}),"\n",(0,l.jsx)(n.p,{children:"Actions in this section should be done on deployment machine"}),"\n",(0,l.jsx)(n.h4,{id:"step-3-backup-current-system-on-deployment-machine",children:"Step 3: Backup Current System (On Deployment Machine)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# 1. Go to current deploy\ncd /opt/bublik-docker/current\n\n# 2. Create DB backup\ntask backup:create\n\n# 3. Copy backup to safe location\ncp backups/backup_*.sql /tmp/bublik-backup-$(date +%Y%m%d_%H%M%S).sql\n"})}),"\n",(0,l.jsx)(n.h4,{id:"step-4-apply-update-on-deployment-machine",children:"Step 4: Apply Update (On Deployment Machine)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Set the NEW version you\'re updating to (MUST match preparation machine)\nexport BUBLIK_NEW_VERSION=2.2.0\n\necho "Applying update to Bublik version: $BUBLIK_NEW_VERSION"\n\n# 1. Extract archive with update\ntar xzf ~/bublik-update-$BUBLIK_NEW_VERSION.tar.gz -C /opt/bublik-docker\n\n# 2. Load new images\ndocker load -i "/opt/bublik-docker/images/bublik-$BUBLIK_NEW_VERSION.tar"\n\n# 3. Verify new images loaded\ndocker image ls\n\n# 4. Re-link to new version\nln -sfn "/opt/bublik-docker/versions/bublik-$BUBLIK_NEW_VERSION" "/opt/bublik-docker/current"\n# Verify link\nls -lha /opt/bublik-docker | grep "current"\n\n# 5. Re-link old configuration\nln -sfn /opt/bublik-docker/config/.env /opt/bublik-docker/current/.env\n# Verify link\nls -lha /opt/bublik-docker/current/.env | grep ".env"\n\n# 6. Update IMAGE_TAG in configuration\nsed -i "s/^IMAGE_TAG=.*/IMAGE_TAG=$BUBLIK_NEW_VERSION/" /opt/bublik-docker/config/.env\n# Verify IMAGE_TAG is correctly set\ncat /opt/bublik-docker/config/.env | grep "IMAGE_TAG"\n'})}),"\n",(0,l.jsx)(n.h4,{id:"step-5-start-updated-application-on-deployment-machine",children:"Step 5: Start Updated Application (On Deployment Machine)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# 1. Navigate to new current version\ncd /opt/bublik-docker/current\n\n# 2. Start updated application\ntask up\n\n# 3. Monitor logs for successful startup\ndocker compose logs -f\n\n# 4. Verify application is running correctly\ndocker compose ps\n"})}),"\n",(0,l.jsx)(n.h3,{id:"update-path-example",children:"Update Path Example"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Scenario"}),": Updating from version 1.7.0 \u2192 1.10.0"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Required Update Sequence"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"1.7.0 \u2192 1.8.0 \u2192 1.9.0 \u2192 1.10.0\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Execution Steps"}),":"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Update 1.7.0 \u2192 1.8.0"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"export BUBLIK_NEW_VERSION=1.8.0\n# Follow update process\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Review 1.8.0 release notes"}),"\n",(0,l.jsx)(n.li,{children:"Test functionality before proceeding"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Update 1.8.0 \u2192 1.9.0"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"export BUBLIK_NEW_VERSION=1.9.0\n# Follow update process\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Review 1.9.0 release notes"}),"\n",(0,l.jsx)(n.li,{children:"Test functionality before proceeding"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Update 1.9.0 \u2192 1.10.0"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"export BUBLIK_NEW_VERSION=1.10.0\n# Follow update process\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Review 1.10.0 release notes"}),"\n",(0,l.jsx)(n.li,{children:"Final testing and validation"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"post-deployment",children:"Post-Deployment"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Startup Information:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Initial startup may take up to 30 seconds"}),"\n",(0,l.jsxs)(n.li,{children:["Check logs with ",(0,l.jsx)(n.code,{children:"docker compose logs -f"})," if needed"]}),"\n",(0,l.jsxs)(n.li,{children:["By default Bublik ",(0,l.jsx)(n.strong,{children:"will be served on port 80"}),", you can adjust this by editing ",(0,l.jsx)(n.code,{children:"BUBLIK_DOCKER_PROXY_PORT"})," in ",(0,l.jsx)(n.code,{children:"/opt/bublik-docker/config/.env"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"access-your-application",children:"Access Your Application"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Navigate to ",(0,l.jsx)(n.code,{children:"http://<target_machine_ip>"})," in your browser"]}),"\n",(0,l.jsxs)(n.li,{children:["Default ports are defined in your ",(0,l.jsx)(n.code,{children:"/opt/bublik-docker/config/.env"})," file"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"database-migration-if-applicable",children:"Database Migration (If Applicable)"}),"\n",(0,l.jsx)(n.p,{children:"If you're migrating to docker deployment from a bare metal installation:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# 1. Run these commands on your old database server\npg_dump -h <db_host> -U <username> -d bublik -f backup_$(date +%Y%m%d_%H%M%S).sql\n\n# 2. Transfer backup to deploy machine machine\nscp backup_*.sql <deploy_machine>:~/\n\n# 3. On deploy machine - restore database\ncd /opt/bublik-docker/current\ntask backup:restore -- <path_to_backup.sql>\n\n# 4. Restart application\ntask up\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);